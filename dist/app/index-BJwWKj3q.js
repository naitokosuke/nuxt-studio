const e=[[/^(<!--)(.+)(-->)$/,!1],[/^(\/\*)(.+)(\*\/)$/,!1],[/^(\/\/|["'#]|;{1,2}|%{1,2}|--)(.*)$/,!0],[/^(\*)(.+)$/,!0]];function t(e,t){if("element"!==e.type)return!1;const n=e.children[0];return"text"===n.type&&n.value.trim()===t}function n(t,n){let i=t.trimStart();const s=t.length-i.length;i=i.trimEnd();const l=t.length-i.length-s;for(const[o,c]of e){if(c&&!n)continue;const e=o.exec(i);if(e)return[" ".repeat(s)+e[1],e[2],e[3]?e[3]+" ".repeat(l):void 0]}}function i(e){const t=e.match(/(?:\/\/|["'#]|;{1,2}|%{1,2}|--)(\s*)$/);return t&&0===t[1].trim().length?e.slice(0,t.index):e}function s(e,s,l,o){return null==o&&(o="v3"),{name:e,code(e){const c=e.children.filter(e=>"element"===e.type),r=[];e.data??={};const a=e.data;a._shiki_notation??=function(e,i,s){const l=[];for(const o of e){if("v3"===s){const e=o.children.flatMap((e,t)=>{if("element"!==e.type)return e;const i=e.children[0];if("text"!==i.type)return e;const s=t===o.children.length-1;if(!n(i.value,s))return e;const l=i.value.split(/(\s+\/\/)/);if(l.length<=1)return e;let c=[l[0]];for(let n=1;n<l.length;n+=2)c.push(l[n]+(l[n+1]||""));return c=c.filter(Boolean),c.length<=1?e:c.map(t=>({...e,children:[{type:"text",value:t}]}))});e.length!==o.children.length&&(o.children=e)}const e=o.children;let c=e.length-1;"v1"===s?c=0:i&&(c=e.length-2);for(let s=Math.max(c,0);s<e.length;s++){const c=e[s];if("element"!==c.type)continue;const r=c.children.at(0);if("text"!==r?.type)continue;const a=s===e.length-1;let d,f=n(r.value,a);if(!f&&s>0&&r.value.trim().startsWith("[!code")){const t=e[s-1];if("element"===t?.type){const i=t.children.at(0);if("text"===i?.type&&i.value.includes("//")){const s=n(i.value+r.value,a);if(s){f=s,l.push({info:s,line:o,token:t,isLineCommentOnly:2===e.length&&1===t.children.length&&1===c.children.length,isJsxStyle:!1,additionalTokens:[c]});continue}}}}if(f)if(i&&!a&&0!==s){const n=t(e[s-1],"{")&&t(e[s+1],"}");l.push({info:f,line:o,token:c,isLineCommentOnly:3===e.length&&1===c.children.length,isJsxStyle:n,additionalTokens:d})}else l.push({info:f,line:o,token:c,isLineCommentOnly:1===e.length&&1===c.children.length,isJsxStyle:!1,additionalTokens:d})}}return l}(c,["jsx","tsx"].includes(this.options.lang),o);const d=a._shiki_notation;for(const t of d){if(0===t.info[1].length)continue;let e=c.indexOf(t.line);t.isLineCommentOnly&&"v1"!==o&&e++;let n=!1;if(t.info[1]=t.info[1].replace(s,(...i)=>l.call(this,i,t.line,t.token,c,e)?(n=!0,""):i[0]),!n)continue;"v1"===o&&(t.info[1]=i(t.info[1]));const a=0===t.info[1].trim().length;if(a&&(t.info[1]=""),a&&t.isLineCommentOnly)r.push(t.line);else if(a&&t.isJsxStyle)t.line.children.splice(t.line.children.indexOf(t.token)-1,3);else if(a){if(t.additionalTokens)for(let e=t.additionalTokens.length-1;e>=0;e--){const n=t.additionalTokens[e],i=t.line.children.indexOf(n);-1!==i&&t.line.children.splice(i,1)}t.line.children.splice(t.line.children.indexOf(t.token),1)}else{const e=t.token.children[0];if("text"===e.type&&(e.value=t.info.join(""),t.additionalTokens))for(const n of t.additionalTokens){const e=n.children[0];"text"===e?.type&&(e.value="")}}}for(const t of r){const n=e.children.indexOf(t),i=e.children[n+1];let s=1;"text"===i?.type&&"\n"===i?.value&&(s=2),e.children.splice(n,s)}}}}function l(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function o(e={},t="@shikijs/transformers:notation-map"){const{classMap:n={},classActivePre:i,classActiveCode:o}=e;return s(t,new RegExp(`#?\\s*\\[!code (${Object.keys(n).map(l).join("|")})(:\\d+)?\\]`,"gi"),function([e,t,s=":1"],l,c,r,a){const d=Number.parseInt(s.slice(1),10);for(let i=a;i<Math.min(a+d,r.length);i++)this.addClassToHast(r[i],n[t]);return i&&this.addClassToHast(this.pre,i),o&&this.addClassToHast(this.code,o),!0},e.matchAlgorithm)}function c(e={}){const{classLineAdd:t="diff add",classLineRemove:n="diff remove",classActivePre:i="has-diff",classActiveCode:s}=e;return o({classMap:{"++":t,"--":n},classActivePre:i,classActiveCode:s,matchAlgorithm:e.matchAlgorithm},"@shikijs/transformers:notation-diff")}function r(e={}){const{classMap:t={error:["highlighted","error"],warning:["highlighted","warning"]},classActivePre:n="has-highlighted",classActiveCode:i}=e;return o({classMap:t,classActivePre:n,classActiveCode:i,matchAlgorithm:e.matchAlgorithm},"@shikijs/transformers:notation-error-level")}function a(e={}){const{classActiveLine:t="focused",classActivePre:n="has-focused",classActiveCode:i}=e;return o({classMap:{focus:t},classActivePre:n,classActiveCode:i,matchAlgorithm:e.matchAlgorithm},"@shikijs/transformers:notation-focus")}function d(e={}){const{classActiveLine:t="highlighted",classActivePre:n="has-highlighted",classActiveCode:i}=e;return o({classMap:{highlight:t,hl:t},classActivePre:n,classActiveCode:i,matchAlgorithm:e.matchAlgorithm},"@shikijs/transformers:notation-highlight")}export{s as createCommentNotationTransformer,c as transformerNotationDiff,r as transformerNotationErrorLevel,a as transformerNotationFocus,d as transformerNotationHighlight,o as transformerNotationMap};
